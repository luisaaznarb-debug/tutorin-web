export type Step = {
text: string;
imageUrl?: string | null;
};

export type SkillFn = (input: string) => Step[];
export type TutorEngine = Map<string, SkillFn>;

export const engine: TutorEngine = new Map<string, SkillFn>();

// =======================================
// üß† DETECCI√ìN AUTOM√ÅTICA DE SKILLS
// =======================================

export function detectSkill(input: string): string | null {
const text = input.toLowerCase();

if (/\b(suma|sumar|\+|m√°s)\b/.test(text)) return 'mates:suma';
if (/\b(resta|restar|menos|\-)\b/.test(text)) return 'mates:resta';
if (/\b(multiplicar|multiplicaci√≥n|x|\*)\b/.test(text)) return 'mates:multiplicacion';
if (/\b(dividir|divisi√≥n|entre|\/)\b/.test(text)) return 'mates:division';
if (/fracci(√≥n|ones)|numerador|denominador/.test(text)) return 'mates:fracciones';
if (/porcentaje|%/.test(text)) return 'mates:porcentajes';
if (/per[i√≠]metro/.test(text)) return 'mates:geometria:perimetro';
if (/√°rea|superficie/.test(text)) return 'mates:geometria:area';
if (/figuras? geom[e√©]tricas?/.test(text)) return 'mates:geometria:figuras';
if (/metros|litros|gramos|medidas/.test(text)) return 'mates:medidas';
if (/gr√°fica|tabla|media/.test(text)) return 'mates:datos';

if (/sustantivo/.test(text)) return 'lengua:sustantivos';
if (/verbo/.test(text)) return 'lengua:verbos';
if (/adjetivo/.test(text)) return 'lengua:adjetivos';
if (/determinante/.test(text)) return 'lengua:determinantes';
if (/oraci[o√≥]n/.test(text)) return 'lengua:oracion';
if (/comprensi[o√≥]n lectora/.test(text)) return 'lengua:comprension';
if (/ortograf[i√≠]a|tilde|acent[ou]/.test(text)) return 'lengua:ortografia';

if (/cuerpo humano|pulmones|coraz[o√≥]n|sistema/.test(text)) return 'ciencias:cuerpohumano';
if (/planta|ra[i√≠]z|tallo|hojas/.test(text)) return 'ciencias:plantas';
if (/agua|evaporaci[o√≥]n|condensaci[o√≥]n|ciclo/.test(text)) return 'ciencias:agua';
if (/mapa|provincia|comunidad/.test(text)) return 'sociales:mapas';
if (/prehistoria|edad (media|moderna|contempor[√°a]nea|antigua)/.test(text)) return 'historia:epocas';

if (/color|colores en ingl[e√©]s/.test(text)) return 'ingles:vocabulario';
if (/saludos|valenci[a√†]n/.test(text)) return 'valenciano:saludos';

return null;
}

// =======================================
// üßÆ MATEM√ÅTICAS (1¬∫ a 6¬∫ PRIMARIA)
// =======================================

engine.set('mates:suma', () => [
  { text: 'Paso 1: Coloca los n√∫meros en columnas: unidades, decenas, centenas.' },
  { text: 'Paso 2: Suma de derecha a izquierda. ¬øTienes que llevar?' },
]);

engine.set('mates:resta', () => [
  { text: 'Paso 1: Coloca los n√∫meros en columnas.' },
  { text: 'Paso 2: Resta de derecha a izquierda. ¬øTienes que pedir prestado?' },
]);

engine.set('mates:multiplicacion', () => [
  { text: 'Paso 1: Multiplica cifra a cifra la parte inferior por cada cifra superior.' },
  { text: 'Paso 2: Suma los resultados parciales correctamente alineados.' },
]);

engine.set('mates:division', () => [
  { text: 'Paso 1: ¬øCu√°ntas veces cabe el divisor en el primer n√∫mero del dividendo?' },
  { text: 'Paso 2: Baja cifras y repite. No olvides comprobar el resto.' },
]);

engine.set('mates:fracciones', () => [
  { text: 'Paso 1: Identifica numerador y denominador.', imageUrl: '/images/fraccion.png' },
  { text: 'Paso 2: Aplica la operaci√≥n: suma, resta, multiplicaci√≥n o divisi√≥n.' },
]);

engine.set('mates:porcentajes', () => [
  { text: 'Paso 1: Convierte el porcentaje a fracci√≥n o decimal.' },
  { text: 'Paso 2: Aplica al n√∫mero. Por ejemplo, 25% de 80 es 0.25 √ó 80.' },
]);

engine.set('mates:geometria:figuras', () => [
  { text: 'Paso 1: Observa los lados y √°ngulos. ¬øEs tri√°ngulo, cuadrado, rect√°ngulo‚Ä¶?', imageUrl: '/images/figuras.png' },
  { text: 'Paso 2: Revisa la definici√≥n de la figura para comprobar.' },
]);

engine.set('mates:geometria:perimetro', () => [
  { text: 'Paso 1: Suma todos los lados de la figura.', imageUrl: '/images/perimetro.png' },
]);

engine.set('mates:geometria:area', () => [
  { text: 'Paso 1: Usa la f√≥rmula correcta. Por ejemplo: √°rea = base √ó altura para rect√°ngulo.', imageUrl: '/images/area.png' },
]);

engine.set('mates:medidas', () => [
  { text: 'Paso 1: Identifica la unidad. ¬øEs metro, litro, gramo, etc.?' },
  { text: 'Paso 2: Convierte si es necesario: 1 m = 100 cm, 1 L = 1000 ml‚Ä¶' },
]);

engine.set('mates:datos', () => [
  { text: 'Paso 1: Observa el gr√°fico o tabla. ¬øQu√© te muestra?' },
  { text: 'Paso 2: Lee los valores y responde con cuidado.' },
]);

// =======================================
// ‚úçÔ∏è LENGUA CASTELLANA
// =======================================

engine.set('lengua:sustantivos', () => [
  { text: 'Paso 1: Busca palabras que nombran personas, animales o cosas.' },
  { text: 'Paso 2: ¬øEs un sustantivo com√∫n o propio?' },
]);

engine.set('lengua:verbos', () => [
  { text: 'Paso 1: Identifica la acci√≥n en la oraci√≥n.' },
  { text: 'Paso 2: ¬øEst√° en presente, pasado o futuro?' },
]);

engine.set('lengua:adjetivos', () => [
  { text: 'Paso 1: ¬øQu√© palabra acompa√±a al sustantivo y lo describe?' },
]);

engine.set('lengua:determinantes', () => [
  { text: 'Paso 1: Busca palabras que van delante del sustantivo y lo concretan.' },
]);

engine.set('lengua:oracion', () => [
  { text: 'Paso 1: ¬øD√≥nde est√° el sujeto? ¬øQui√©n hace la acci√≥n?' },
  { text: 'Paso 2: ¬øD√≥nde est√° el predicado? ¬øQu√© hace el sujeto?' },
]);

engine.set('lengua:comprension', () => [
  { text: 'Paso 1: Lee el texto con atenci√≥n. Subraya palabras clave.' },
  { text: 'Paso 2: Busca en el texto pistas para responder.' },
]);

engine.set('lengua:ortografia', () => [
  { text: 'Paso 1: Revisa si hay tildes. ¬øLa palabra es aguda, llana o esdr√∫jula?' },
  { text: 'Paso 2: Cuidado con la b/v, g/j, ll/y‚Ä¶' },
]);

// =======================================
// üî¨ CIENCIAS NATURALES y SOCIALES
// =======================================

engine.set('ciencias:cuerpohumano', () => [
  { text: 'Paso 1: ¬øQu√© sistema est√°s estudiando? (digestivo, respiratorio...)', imageUrl: '/images/cuerpohumano.png' },
  { text: 'Paso 2: ¬øQu√© √≥rganos forman parte de √©l y qu√© hacen?' },
]);

engine.set('ciencias:plantas', () => [
  { text: 'Paso 1: Identifica partes de la planta: ra√≠z, tallo, hojas, flor.', imageUrl: '/images/planta.png' },
  { text: 'Paso 2: ¬øQu√© funci√≥n tiene cada parte?' },
]);

engine.set('ciencias:agua', () => [
  { text: 'Paso 1: ¬øQu√© estados tiene el agua?', imageUrl: '/images/cicloagua.png' },
  { text: 'Paso 2: ¬øC√≥mo pasa de uno a otro? (evaporaci√≥n, condensaci√≥n...)' },
]);

engine.set('sociales:mapas', () => [
  { text: 'Paso 1: ¬øQu√© tipo de mapa es? (f√≠sico, pol√≠tico, etc.)', imageUrl: '/images/mapa.png' },
  { text: 'Paso 2: Busca el lugar que te piden. ¬øEn qu√© comunidad est√°?' },
]);

engine.set('historia:epocas', () => [
  { text: 'Paso 1: ¬øEn qu√© √©poca estamos? Prehistoria, Edad Antigua, Edad Media...', imageUrl: '/images/epocas.png' },
  { text: 'Paso 2: ¬øQu√© pas√≥ en esa √©poca?' },
]);

// =======================================
// üåç IDIOMAS: INGL√âS y VALENCIANO
// =======================================

engine.set('ingles:vocabulario', () => [
  { text: 'Paso 1: ¬øQu√© significa esa palabra? Consulta si no est√°s seguro.' },
  { text: 'Paso 2: ¬øPuedes usarla en una frase simple?' },
]);

engine.set('valenciano:saludos', () => [
  { text: 'Paso 1: ¬øC√≥mo se dice "hola", "buenos d√≠as" o "adi√≥s" en valenci√†?' },
]);

// Puedes a√±adir m√°s idiomas o dialectos aqu√≠.
